# Ansible Role: Docker

The **`docker` role** automates the installation and configuration of Docker on Linux hosts. It handles installation of Docker Engine, CLI, containerd, and the Compose plugin, manages prerequisite packages, configures repositories, and ensures users are added to the Docker group. The role is designed to be **idempotent** and suitable for both **homelab** and **production** environments.

---

## Features

* **Docker Installation**

  * Adds Dockerâ€™s official GPG key and repository
  * Installs Docker Engine, CLI, containerd, and Compose plugin
  * Ensures prerequisite packages are installed
* **User Management**

  * Loads common user metadata from `/etc/ansible/common_users.yml`
  * Adds users tagged with `docker` to the Docker group
  * Ensures the `docker` group exists

---

## Requirements

* Supported platforms: Ubuntu, Debian, and other Debian-based distributions
* Ansible 2.9+
* Access to `/etc/ansible/common_users.yml` on target hosts

---

## Role Variables

### `common_users.yml` Structure

This file is expected on the target host:

```yaml
common_users:
  - name: alice
    tags: ['docker']
  - name: bob
    tags: []
```

Users with the `docker` tag will be added to the Docker group.

## Dependencies

* None, but ensure `common_users.yml` exists if you want automatic user group management.  It can be generated by this global ifrastructure role if run prior:  https://github.com/konkele/ansible-role-common

---

## Example Playbook

```yaml
- hosts: docker_hosts
  become: yes
  roles:
    - role: docker
```

---

## Quick-Start Example for `common_users.yml`

```yaml
common_users:
  - name: alice
    tags: ['docker']
  - name: bob
    tags: []
```

Run the playbook as:

```bash
ansible-playbook -i inventory docker_playbook.yml
```

---

## License

MIT License
